
<% content_for :sidebar do %>
  <div class="panel panel-default">
    <div class="panel-heading">发布帖子</div>
    <div class="panel-body">
      <%= link_to '发布帖子', new_post_path, class: "btn btn-danger" %>
    </div>
  </div>
<% end %>


<div class="panel panel-default">
  <div class="panel-heading">
    <%= @post.title %>
    <%= @post.topic.name %>
    <%= @post.user.username %>
    <span>发表于<time class="timeago" datetime="<%= @post.created_at.to_formatted_s(:iso8601) %>"></time></span>
  </div>
  <div class="panel-body">
    <%= raw @post.content %>
    <%= link_to('Edit', edit_post_path(@post)) if can? :update, @post %> |
  </div>
</div>

<ul class="list-group">
  <% @post.comments.each do |comment| %>
    <li class="list-group-item">
      <div class="media">
        <div class="media-left">
          <%= link_to image_tag(comment.user.avatar.url(:thumb), alt: "头像", class: "avatar media-object"), user_path(comment.user) %>
        </div>
        <div class="media-body">
		  <p>
		  <span><%= comment.user.username %></span>
		  <span>回复于<time class="timeago" datetime="<%= comment.created_at.to_formatted_s(:iso8601) %>"></time></span>
		  </p>
          <p class="media-heading"><%= raw comment.content %></p>
        </div>
      </div>
    </li>
  <% end %>
</ul>

<% if user_signed_in? %>
  <%= render partial: "comments/form", locals: {post: @post} %>
<% elsif %>
  <%= link_to '登录', new_user_session_path %>
<% end %>
